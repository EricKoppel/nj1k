@(news: List[NewsEntity], recentAscents: List[AscentEntity], signupForm: Form[RegisteringUser])
@import java.text.SimpleDateFormat
@import views.RenderUtil._
@import utils.SecurityUtil._
@import helper._

@main(title = Messages("welcome.header")) {
<meta name="description" content="NJ1K.org - A website dedicated to peakbagging in New Jersey. Climb New Jersey's 52 peaks over 1,000 feet. Peakbagging in the humble hills of New Jersey.">
} {
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">@Messages("registration")</h4>
				</div>
				<div class="modal-body">
				@helper.form(action = routes.RegistrationController.submit) {
			        <fieldset>
			            
			            @inputText(
			                signupForm("email"), 
			                '_label -> Messages("email"),
			                'type -> "email",
			                '_showConstraints -> false,
			                'class -> "form-control"
			            )
	            
			            @inputText(
			                signupForm("name"), 
			                '_label -> Messages("name"),
			                '_showConstraints -> false,
			                'class -> "form-control"
			            )
	
			            @inputPassword(
			                signupForm("password"), 
			                '_label -> Messages("password"),
			                '_showConstraints -> false,
			                'class -> "form-control"
			            )
	
			            @inputPassword(
			                signupForm("confirmPassword"), 
			                '_label -> Messages("confirmpassword"),
			                '_showConstraints -> false,
			                'class -> "form-control"
			            )
	
			            @inputText(
			           		signupForm("challenge"),
			           		'_label -> Messages("email.antispam"),
			           		'_showConstraints -> false,
			           		'class -> "story_title form-control"
			        	)
			        </fieldset>
			        
			        <div class="actions">
			            <input type="submit" class="btn btn-primary" value="Sign Up">
			            <a href="#" class="btn btn-danger" data-dismiss="modal">Cancel</a>
			        </div>
			        
			    }
				</div>
			</div>
		</div>
	</div>

	<div class="jumbotron hidden-sm hidden-xs">
		<div class="container">
			<div class="row">
				<div itemscope itemtype="https://schema.org/Organization" class="col-md-12">
					<h1 itemprop="name" style="font-family: Futura, Trebuchet MS, Arial, sans-serif;">@Messages("welcome.header")</h1>
					<p itemprop="description"><strong>@formatText(Messages("welcometext"))</strong></p>
					<p><small>The New Jersey 1K Club seeks to bring attention to the many hiking opportunities and challenges that the Garden State has to offer. New Hampshire has the AMC 4000'ers; the Adirondacks has its 46'ers; the Catskills and its 3500 Club. And now . . . New Jersey's own peakbagging club: the 1K'ers.</small></p>
					@if(!isLoggedIn()) {
						<button class="btn btn-success btn-lg" data-toggle="modal" data-target="#myModal">
							<span class="glyphicon glyphicon-check"></span>
							<span>@Messages("menu.register")</span>
						</button>
					}
				</div>
			</div>
			
		</div>
		
	</div>
} {

	@if(isLoggedIn()) {
	<div class="row">
		<div class="visible-xs col-xs-12">
			<p><a id="logMobileAscent" class="btn btn-primary btn-lg btn-block" href="#">@Messages("ascent.quick")</a></p>
		</div>
	</div>
	
	<script type="text/javascript">
		require(['jquery', 'moment'], function() {
			
			$('#logMobileAscent').click(function() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						console.debug(position.coords.latitude + ',' + position.coords.longitude);
						var threshold = 0.5;
						
						var r = jsRoutes.controllers.MountainsController.findNearest(position.coords.latitude, position.coords.longitude, threshold);
						
						$.ajax({
		  					 url: r.url,
		  					 success: function(data) {
		  						 
		  						if ($.isEmptyObject(data)) {
		  							alert("@Messages("not.on.summit")");
		  							window.location = '@routes.AscentController.showForm()';
		  						}
		  						
		  						$.each(data, function(i, item) {
		  							
		  							if (i > 4) {
		  								window.location = '@routes.AscentController.showForm()';
		  								return false;
		  							}
		  							
		  							if(confirm('Are you standing on ' + item.name + '?')) {
		  								var u = jsRoutes.controllers.AscentController.submit();
		  								$.ajax({
		  									type: 'POST',
		  									url: u.url,
		  									data: {
		  										successful: true,
		  										mountain: item.id,
		  										ascent_date: moment().format('YYYY-MM-DD')
		  									},
		  									success: function() {
		  										window.location = '@routes.Application.index()';
		  									}
		  								});
		  								
		  								return false;
		  							}
		  						});
		  					 }
						});
					});
				}
			});
		});
	</script>
	}
	
	<div class="row">
		<div class="col-md-12">
			@for(n <- news) {
				<div class="media" style="border-bottom: 1px solid #ddd">
					@if(!n.pictures.isEmpty()) {
						<a class="hidden-xs pull-right" href="@routes.NewsController.showNews(n.id)">
							<img alt="@n.title" width="64" height="64" class="media-object" src="@routes.NewsImageController.getImage(n.pictures.get(0).id)">
						</a>
					}
					<div class="media-body">
						<h3 class="media-heading"><a href="@routes.NewsController.showNews(n.id)"><strong><em>@n.title</em></strong></a></h3>
						<p>
							<strong>@formatAscentDate(n.news_date) - </strong>
							@Html(formatNews(n.entry))
							<p><a href="@routes.NewsController.showNews(n.id)"><em>Read More...</em></a></p>
						</p>
					</div>
				</div>
			}
		</div>
	</div>
	
	<div style="padding-bottom: 30px"></div>
	<div class="row">
		<div class="col-md-6 hidden-xs">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">@Messages("news.nynjtc")</h3>
				</div>
				<div class="panel-body">
					<div id="externalNews"></div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript">
			require(['jquery'], function() {
				jsRoutes.controllers.ExternalNewsController.getNewsFromNYNJTC().ajax({
		  		  success: function(data) {
		  			  $.each(data, function(i, item) {
		  				  var r = jsRoutes.controllers.ExternalNewsController.getNewsArticleFromNYNJTC(item.link);
		  				  var mediaBody = $('<div class="media-body">');
		  				  $(mediaBody).append('<h4 class="media-heading"><em><a target="_blank" href="' + item.link + '">' + item.title + '</a></em></h4>');
		  				
		  				  $('<div class="media">').append(mediaBody).appendTo('#externalNews');
		  				  
		  				  $.ajax({
		  					  url: r.url,
		  					  cache: true,
		  					  success: function(data) {
		  	    				  $(mediaBody).append('<p><strong>' + item.date + ' - </strong>' + data + ' (<a target="_blank" href="' + item.link + '"><em>read more...</em></a>)');
		  					  }
		  				  });
		  			  });
					}
				});
			});
		</script>
		
		<div class="col-md-6 col-xs-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">@Messages("most.recent.climbs")</h3>
				</div>
				<div id="infiniteScroll">
				@recentAscentsPanel(recentAscents, 1, 5)
				</div>
			</div>
		</div>
	</div>
}
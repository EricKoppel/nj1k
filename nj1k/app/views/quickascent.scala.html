<div class="row">
		<div class="visible-xs col-xs-12">
			<p><a id="logMobileAscent" class="btn btn-primary btn-lg btn-block" href="#">@Messages("ascent.quick")</a></p>
		</div>
	</div>
	
	<script type="text/javascript">
		require(['jquery', 'moment'], function() {
			
			$('#logMobileAscent').click(function() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
						console.debug(position.coords.latitude + ',' + position.coords.longitude);
						var threshold = 0.5;
						
						var r = jsRoutes.controllers.MountainsController.findNearest(position.coords.latitude, position.coords.longitude, threshold);
						
						$.ajax({
		  					 url: r.url,
		  					 success: function(data) {
		  						 
		  						if ($.isEmptyObject(data)) {
		  							alert("@Messages("not.on.summit")");
		  							window.location = '@routes.AscentController.showForm()';
		  						}
		  						
		  						$.each(data, function(i, item) {
		  							
		  							if (i > 4) {
		  								window.location = '@routes.AscentController.showForm()';
		  								return false;
		  							}
		  							
		  							if(confirm('Are you standing on ' + item.name + '?')) {
		  								var u = jsRoutes.controllers.AscentController.submit();
		  								$.ajax({
		  									type: 'POST',
		  									url: u.url,
		  									data: {
		  										successful: true,
		  										mountain: item.id,
		  										ascent_date: moment().format('YYYY-MM-DD')
		  									},
		  									success: function() {
		  										window.location = '@routes.Application.index()';
		  									}
		  								});
		  								
		  								return false;
		  							}
		  						});
		  					 }
						});
					});
				}
			});
		});
	</script>